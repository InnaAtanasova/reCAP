/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Input","./Tokenizer","./Token","./library","sap/ui/core/EnabledPropagator","sap/ui/base/ManagedObjectMetadata","sap/ui/Device","./Popover","./List","./Title","./Bar","./Toolbar","./StandardListItem","sap/ui/core/ResizeHandler","sap/ui/core/IconPool","./MultiInputRenderer","sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","sap/ui/core/InvisibleText","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/cursorPos","sap/ui/dom/jquery/control"],function(e,t,i,o,s,n,r,a,l,g,p,h,u,d,c,f,_,k,y,T){"use strict";var v=o.PlacementType,m=o.ListMode,b=o.TokenizerRenderMode;var I=e.extend("sap.m.MultiInput",{metadata:{library:"sap.m",designtime:"sap/m/designtime/MultiInput.designtime",properties:{enableMultiLineMode:{type:"boolean",group:"Behavior",defaultValue:false},maxTokens:{type:"int",group:"Behavior"}},aggregations:{tokens:{type:"sap.m.Token",multiple:true,singularName:"token"},tokenizer:{type:"sap.m.Tokenizer",multiple:false,visibility:"hidden"}},events:{tokenChange:{parameters:{type:{type:"string"},token:{type:"sap.m.Token"},tokens:{type:"sap.m.Token[]"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}},tokenUpdate:{allowPreventDefault:true,parameters:{type:{type:"string"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}}},dnd:{draggable:false,droppable:true}}});s.apply(I.prototype,[true]);var S=sap.ui.getCore().getLibraryResourceBundle("sap.m");I.prototype.init=function(){this._bShowListWithTokens=false;e.prototype.init.call(this);this._bIsValidating=false;this.setAggregation("tokenizer",new t({renderMode:b.Narrow}));var i=this.getAggregation("tokenizer");i.attachTokenChange(this._onTokenChange,this);i.attachTokenUpdate(this._onTokenUpdate,this);i._handleNMoreIndicatorPress(this._handleIndicatorPress.bind(this));i.addEventDelegate({onThemeChanged:this._handleInnerVisibility.bind(this),onAfterRendering:function(){this._syncInputWidth(i);this._handleInnerVisibility();this._handleNMoreAccessibility();this._registerTokenizerResizeHandler()}.bind(this)},this);this._aTokenValidators=[];this.setShowValueHelp(true);this.setShowSuggestion(true);this.attachSuggestionItemSelected(this._onSuggestionItemSelected,this);this.attachLiveChange(this._onLiveChange,this);this.attachValueHelpRequest(this._onValueHelpRequested,this);this._getValueHelpIcon().setProperty("visible",true,true);this._modifySuggestionPicker();this._onResize=this._onResize.bind(this)};I.prototype.exit=function(){this._deregisterResizeHandler();this._deregisterTokenizerResizeHandler();e.prototype.exit.call(this);if(this._oSelectedItemPicker){this._oSelectedItemPicker.destroy();this._oSelectedItemPicker=null}if(this._oSelectedItemsList){this._oSelectedItemsList.destroy();this._oSelectedItemsList=null}if(this._getReadOnlyPopover()){var t=this._getReadOnlyPopover();t.destroy();t=null}};I.prototype.onAfterRendering=function(){var t=this.getAggregation("tokenizer");this._bTokenIsValidated=false;t.setMaxWidth(this._calculateSpaceForTokenizer());t.scrollToEnd();this._registerResizeHandler();e.prototype.onAfterRendering.apply(this,arguments)};I.prototype._handleInnerVisibility=function(){var e=!!this.getAggregation("tokenizer").getHiddenTokensCount();this._setValueVisible(!e)};I.prototype.oninput=function(t){this.setProperty("selectedKey","",true);e.prototype.oninput.call(this,t);if(t.isMarked("invalid")||!this.getEditable()){return}this._setValueVisible(true);this._manageListsVisibility(false);this._getSelectedItemsPicker().close()};I.prototype._registerResizeHandler=function(){if(!this._iResizeHandlerId){this._iResizeHandlerId=d.register(this,this._onResize)}};I.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){d.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null}};I.prototype._registerTokenizerResizeHandler=function(){if(!this._iTokenizerResizeHandler){this._iTokenizerResizeHandler=d.register(this.getAggregation("tokenizer"),this._onResize)}};I.prototype._deregisterTokenizerResizeHandler=function(){if(this._iTokenizerResizeHandler){d.deregister(this._iTokenizerResizeHandler);this._iTokenizerResizeHandler=null}};I.prototype._onResize=function(){this.getAggregation("tokenizer").setMaxWidth(this._calculateSpaceForTokenizer())};I.prototype._onTokenChange=function(e){this.fireTokenChange(e.getParameters());this.invalidate();if(e.getParameter("type")==="removed"){this.getAggregation("tokenizer").setRenderMode(b.Loose)}if(this._getIsSuggestionPopupOpen()||this.isMobileDevice()){this._fillList()}if(this.isMobileDevice()){this._manageListsVisibility(true)}};I.prototype._onTokenUpdate=function(e){var t=this.fireTokenUpdate(e.getParameters());if(!this.getTokens().length){this.$().find("input").trigger("focus")}if(!t){e.preventDefault()}else{this.invalidate()}};I.prototype._onSuggestionItemSelected=function(e){var t=this.getAggregation("tokenizer"),o=null,s=null,n=t.getTokens().length;if(this.getMaxTokens()&&n>=this.getMaxTokens()||this._bValueHelpOpen){return}if(this._hasTabularSuggestions()){o=e.getParameter("selectedRow")}else{o=e.getParameter("selectedItem");if(o){s=new i({text:o.getText(),key:o.getKey()})}}if(o&&!this._bTokenIsAdded){var r=this.getValue();this.addValidateToken({text:r,token:s,suggestionObject:o,validationCallback:this._validationCallback.bind(this,n)})}if(this.isMobileDevice()){var a=t.getTokens().length;if(n<a){this.setValue("")}if(this._getSuggestionsList()instanceof sap.m.Table){this._getSuggestionsList().addStyleClass("sapMInputSuggestionTableHidden")}else{this._getSuggestionsList().destroyItems()}var l=this.getAggregation("tokenizer").getScrollDelegate();if(l){l.scrollTo(0,0,0)}this._getSuggestionsPopoverInstance()._oPopupInput.focus()}this._bTokenIsAdded=false};I.prototype._onValueHelpRequested=function(){this._bValueHelpOpen=true};I.prototype._onLiveChange=function(e){this.getAggregation("tokenizer")._removeSelectedTokens()};I.prototype._setValueVisible=function(e){var t=e?"1":"0";this.$("inner").css("opacity",t)};I.prototype.onmousedown=function(e){if(e.target==this.getDomRef("content")){e.preventDefault();e.stopPropagation()}};I.prototype.openMultiLine=function(){};I.prototype.closeMultiLine=function(){};I.prototype.showItems=function(){e.prototype.showItems.apply(this,arguments);this._manageListsVisibility(false)};I.prototype.onBeforeRendering=function(){e.prototype.onBeforeRendering.apply(this,arguments);this.getAggregation("tokenizer").setEnabled(this.getEnabled())};I.prototype.onsapnext=function(e){var t=this.getAggregation("tokenizer");if(e.isMarked()){return}var i=T(document.activeElement).control()[0];if(!i){return}if(t===i||t.$().find(i.$()).length>0){t.scrollToEnd();this.$().find("input").trigger("focus")}};I.prototype.onsapbackspace=function(e){if(this._$input.cursorPos()>0||!this.getEditable()||this.getValue().length>0){return}if(!e.isMarked()){t.prototype.onsapbackspace.apply(this.getAggregation("tokenizer"),arguments)}if(e.isMarked("forwardFocusToParent")){this.focus()}e.preventDefault();e.stopPropagation()};I.prototype.onsapdelete=function(e){if(!this.getEditable()){return}if(this.getValue()&&!this._completeTextIsSelected()){return}if(e.isMarked("forwardFocusToParent")){this.focus()}};I.prototype.onkeydown=function(e){var t=this.getAggregation("tokenizer");if(!this.getEnabled()){return}if(e.which===k.TAB){t.selectAllTokens(false)}if((e.ctrlKey||e.metaKey)&&e.which===k.A&&t.getTokens().length>0){t.focus();t.selectAllTokens(true);e.preventDefault()}if((e.ctrlKey||e.metaKey)&&e.which===k.I&&t.getTokens().length){this._manageListsVisibility(true);if(this.getEditable()){this._toggleSelectedItemsPicker()}else{this._toggleReadonlyPopover(this.getDomRef())}e.preventDefault()}};I.prototype.onpaste=function(e){var i,o,s,n=[];if(this.getValueHelpOnly()){return}if(window.clipboardData){i=window.clipboardData.getData("Text")}else{i=e.originalEvent.clipboardData.getData("text/plain")}s=i.split(/\r\n|\r|\n/g);if(s.length<=1){return}setTimeout(function(){if(s){if(this.fireEvent("_validateOnPaste",{texts:s},true)){var e="";for(o=0;o<s.length;o++){if(s[o]){var i=this._convertTextToToken(s[o],true);if(this._addUniqueToken(i)){n.push(i)}else{e=s[o]}}}this.updateDomValue(e);if(n.length>0){this.fireTokenUpdate({addedTokens:n,removedTokens:[],type:t.TokenUpdateType.Added});this.fireTokenChange({addedTokens:n,removedTokens:[],type:t.TokenChangeType.TokensChanged})}}if(n.length){this.cancelPendingSuggest()}}}.bind(this),0)};I.prototype._toggleSelectedItemsPicker=function(){var e=this._getSelectedItemsPicker();this.focus();if(e.isOpen()){this._setValueVisible(true);e.close()}else{this._openSelectedItemsPicker()}};I.prototype._toggleReadonlyPopover=function(e){var t=this._getReadOnlyPopover(),i=t.isOpen();if(i){t.close()}else{this._fillList();t.openBy(e)}};I.prototype._validationCallback=function(e,t){var i=this.getAggregation("tokenizer").getTokens().length;var o=this._getSuggestionsPopoverInstance();this._bIsValidating=false;if(t){this.setValue("");this._bTokenIsValidated=true;if(this.isMobileDevice()&&o&&o._oPopupInput&&e<i){o._oPopupInput.setValue("")}}};I.prototype.onsapprevious=function(e){if(this._getIsSuggestionPopupOpen()){return}if(this._$input.cursorPos()===0){if(e.srcControl===this){t.prototype.onsapprevious.apply(this.getAggregation("tokenizer"),arguments)}}if(e.keyCode===k.ARROW_UP){e.preventDefault()}};I.prototype.onsaphome=function(e){if(!this.getFocusDomRef().selectionStart){t.prototype.onsaphome.apply(this.getAggregation("tokenizer"),arguments)}};I.prototype.onsapend=function(e){if(e.isMarked("forwardFocusToParent")){this.focus()}};I.prototype.onsapenter=function(t){if(e.prototype.onsapenter){e.prototype.onsapenter.apply(this,arguments)}var i=true;if(this._getIsSuggestionPopupOpen()){if(this._hasTabularSuggestions()){i=!this._oSuggestionTable.getSelectedItem()}else{i=!this._getSuggestionsList().getSelectedItem()}}if(i){this._validateCurrentText()}if(t&&t.setMarked&&this._bTokenIsValidated){t.setMarked()}if(!this.getEditable()&&this.getAggregation("tokenizer").getHiddenTokensCount()&&t.target===this.getFocusDomRef()){this._handleIndicatorPress()}this.focus()};I.prototype.onsapfocusleave=function(t){var i=this._getSuggestionsPopoverPopup(),o=this._oSelectedItemPicker,s=false,n=false,r=this.getDomRef()&&_(this.getDomRef(),document.activeElement),a,l,g=this.getAggregation("tokenizer");if(i&&i.isA("sap.m.Popover")){if(t.relatedControlId){a=sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef();s=_(i.getFocusDomRef(),a);n=_(g.getFocusDomRef(),a);if(o){l=_(o.getFocusDomRef(),a)}}}e.prototype.onsapfocusleave.apply(this,arguments);if(this._bIsValidating||this._bValueHelpOpen){return}if(!this.isMobileDevice()&&!s&&t.relatedControlId!==this.getId()&&!n){this._validateCurrentText(true)}if(!this.isMobileDevice()&&this.getEditable()){if(r||s){return}}if(!l&&!n){g.setRenderMode(b.Narrow)}this._handleInnerVisibility()};I.prototype.ontap=function(t){var i=this.getAggregation("tokenizer");if(document.activeElement===this._$input[0]||document.activeElement===i.getDomRef()){i.selectAllTokens(false)}if(t&&t.isMarked("tokenDeletePress")){return}e.prototype.ontap.apply(this,arguments)};I.prototype.onfocusin=function(t){var i=this.getAggregation("tokenizer");this._deregisterTokenizerResizeHandler();this._bValueHelpOpen=false;if(t.target===this.getFocusDomRef()){e.prototype.onfocusin.apply(this,arguments);i.hasOneTruncatedToken()&&i.setFirstTokenTruncated(false)}if(!this.isMobileDevice()&&this.getEditable()&&t.target===this.getDomRef("inner")&&!this._getIsSuggestionPopupOpen()){i.setRenderMode(b.Loose);this._setValueVisible(true)}this._registerResizeHandler()};I.prototype.onsapescape=function(t){this.getAggregation("tokenizer").selectAllTokens(false);this.selectText(0,0);e.prototype.onsapescape.apply(this,arguments)};I.prototype._completeTextIsSelected=function(){var e=this._$input[0];if(e.selectionStart!==0){return false}if(e.selectionEnd!==this.getValue().length){return false}return true};I.prototype._getIsSuggestionPopupOpen=function(){var e=this._getSuggestionsPopoverInstance(),t=this._getSuggestionsPopoverPopup();return e&&t&&t.isOpen()};I.prototype.setEditable=function(t){t=this.validateProperty("editable",t);var i=this._getTokensList(true);if(t===this.getEditable()){return this}if(e.prototype.setEditable){e.prototype.setEditable.apply(this,arguments)}this.getAggregation("tokenizer").setEditable(t);if(t){if(this.isMobileDevice()){this._getSuggestionsPopoverPopup().addContent(i)}else{this._getSelectedItemsPicker().addContent(i)}i.setMode(m.Delete)}else{i.setMode(m.None);this._getReadOnlyPopover().addContent(i)}return this};I.prototype._findItem=function(e,t,i,o){if(!e){return}if(!(t&&t.length)){return}e=e.toLowerCase();var s=t.length;for(var n=0;n<s;n++){var r=t[n];var a=o(r);if(!a){continue}a=a.toLowerCase();if(a===e){return r}if(!i&&a.indexOf(e)===0){return r}}};I.prototype._getSuggestionItem=function(e,t){var i=null;var o=null;if(this._hasTabularSuggestions()){i=this.getSuggestionRows();o=this._findItem(e,i,t,function(e){var t=e.getCells();var i=null;if(t){var o;for(o=0;o<t.length;o++){if(t[o].getText){i=t[o].getText();break}}}return i})}else{i=this.getSuggestionItems();o=this._findItem(e,i,t,function(e){return e.getText()})}return o};I.prototype.clone=function(){var t,i=this.getAggregation("tokenizer");this.detachSuggestionItemSelected(this._onSuggestionItemSelected,this);this.detachLiveChange(this._onLiveChange,this);i.detachTokenChange(this._onTokenChange,this);i.detachTokenUpdate(this._onTokenUpdate,this);this.detachValueHelpRequest(this._onValueHelpRequested,this);t=e.prototype.clone.apply(this,arguments);this.attachSuggestionItemSelected(this._onSuggestionItemSelected,this);this.attachLiveChange(this._onLiveChange,this);i.attachTokenChange(this._onTokenChange,this);i.attachTokenUpdate(this._onTokenUpdate,this);this.attachValueHelpRequest(this._onValueHelpRequested,this);return t};I.getMetadata().forwardAggregation("tokens",{getter:function(){return this.getAggregation("tokenizer")},aggregation:"tokens",forwardBinding:true});I.prototype.getPopupAnchorDomRef=function(){return this.getDomRef("content")};I.prototype.setTokens=function(e){var t,i=[],o;if(Array.isArray(e)){for(o=0;o<e.length;o++){t=this.validateAggregation("tokens",e[o],true);n.addAPIParentInfoBegin(e[o],this,"tokens");i.push(t)}this.getAggregation("tokenizer").setTokens(i);for(o=0;o<e.length;o++){n.addAPIParentInfoEnd(e[o])}}else{throw new Error('"'+e+'" is of type '+typeof e+", expected array for aggregation tokens of "+this)}return this};I.TokenChangeType={Added:"added",Removed:"removed",RemovedAll:"removedAll",TokensChanged:"tokensChanged"};I.WaitForAsyncValidation="sap.m.MultiInput.WaitForAsyncValidation";I.prototype.getDomRefForValueStateMessage=I.prototype.getPopupAnchorDomRef;I.prototype.updateInputField=function(t){e.prototype.updateInputField.call(this,t);var i=this._getSuggestionsPopoverInstance();this.setDOMValue("");if(i._oPopupInput){i._oPopupInput.setDOMValue("")}};I.prototype.onChange=function(e,t,i){t=t||this.getChangeEventParams();if(!this.getEditable()||!this.getEnabled()){return}var o=this._getInputValue(i);if(o===this.getLastValue()){this._bCheckDomValue=false;return}if(!this._bTokenIsValidated){this.setValue(o);o=this.getValue();this.setLastValue(o)}this.fireChangeEvent(o,t);return true};I.prototype.getAccessibilityInfo=function(){var t=this.getTokens().map(function(e){return e.getText()}).join(" ");var i=e.prototype.getAccessibilityInfo.apply(this,arguments);i.type=S.getText("ACC_CTR_TYPE_MULTIINPUT");i.description=((i.description||"")+" "+t).trim();return i};I.prototype._modifySuggestionPicker=function(){var e=this,t,i,o=this._getSuggestionsPopoverPopup();if(!this.isMobileDevice()){return}o.addContent(this._getTokensList());o.attachBeforeOpen(function(){t=e.getTokens();i=t.length?true:false;e._manageListsVisibility(i);e._fillList();e._updatePickerHeaderTitle()}).attachAfterClose(function(){e.getAggregation("tokenizer").setRenderMode(b.Loose);e._bShowListWithTokens=false})};I.prototype._modifyPopupInput=function(e){var t=this;e.addEventDelegate({oninput:t._manageListsVisibility.bind(t,false),onsapenter:function(i){if(e.getValue()){t._closeSuggestionPopup()}t._validateCurrentText();t._setValueVisible(false);t.onChange(i,null,e.getValue())}});return e};I.prototype._hasShowSelectedButton=function(){return true};I.prototype.forwardEventHandlersToSuggPopover=function(t){e.prototype.forwardEventHandlersToSuggPopover.apply(this,arguments);t.setShowSelectedPressHandler(this._handleShowSelectedPress.bind(this))};I.prototype._handleShowSelectedPress=function(e){this._bShowListWithTokens=e.getSource().getPressed();this._manageListsVisibility(this._bShowListWithTokens)};I.prototype._onBeforeOpenTokensPicker=function(){var e=this._getSelectedItemsPicker(),t=this.getDomRef(),i;this._setValueVisible(false);this._fillList();if(t&&e){i=t.offsetWidth/parseFloat(o.BaseFontSize)+"rem";e.setContentMinWidth(i)}};I.prototype.getDialogTitle=function(){var e=this._getSuggestionsPopoverPopup(),t=e&&e.getCustomHeader();if(t){return t.getContentMiddle()[0]}return null};I.prototype._updatePickerHeaderTitle=function(){var e,t;t=this.getLabels();if(t.length){e=t[0];if(e&&typeof e.getText==="function"){this.getDialogTitle().setText(e.getText())}}else{this.getDialogTitle().setText(S.getText("COMBOBOX_PICKER_TITLE"))}};I.prototype._openSelectedItemsPicker=function(){if(this.isMobileDevice()){this._getSuggestionsPopoverPopup().open()}else{var e=this._getSelectedItemsPicker();if(e){e.openBy(this)}}this._manageListsVisibility(true);this._setValueVisible(true);return this};I.prototype._getTokensList=function(e){if(e&&this._oSelectedItemsList){this._oSelectedItemsList.destroy();this._oSelectedItemsList=null}if(!this._oSelectedItemsList){this._oSelectedItemsList=new l({width:"auto",mode:m.Delete}).attachDelete(this._handleNMoreItemDelete,this)}return this._oSelectedItemsList};I.prototype._getSuggestionsList=function(){var e=this._getSuggestionsPopoverInstance();return e&&e._oList};I.prototype._getSuggestionsPopoverInstance=function(){return this._oSuggPopover};I.prototype._getSuggestionsPopoverPopup=function(){return this._oSuggestionPopup};I.prototype._filterTokens=function(e){this._getTokensList().getItems().forEach(function(t){if(t.getTitle().toLowerCase().indexOf(e)>-1){t.setVisible(true)}else{t.setVisible(false)}})};I.prototype._manageListsVisibility=function(e){this._getTokensList().setVisible(e);this._getSuggestionsList()&&this._getSuggestionsList().setVisible(!e);if(this.isMobileDevice()){this._getSuggestionsPopover().getFilterSelectedButton().setPressed(e)}};I.prototype._mapTokenToListItem=function(e){if(!e){return null}var t=new u({selected:true});t.setTitle(e.getText());t.data("tokenId",e.getId());return t};I.prototype._fillList=function(){var e=this.getTokens(),t;if(!e){return}this._getTokensList().removeAllItems();for(var i=0,o=e.length;i<o;i++){var s=e[i],t=this._mapTokenToListItem(s);this._getTokensList().addItem(t)}};I.prototype._handleIndicatorPress=function(){var e=this.getAggregation("tokenizer"),t=e._oIndicator&&!e._oIndicator[0].classList.contains("sapUiHidden"),i=t?e._oIndicator[0]:this.getDomRef();this._bShowListWithTokens=true;if(this.getEditable()){this.focus();this._openSelectedItemsPicker()}else{this._toggleReadonlyPopover(i)}};I.prototype._handleNMoreItemDelete=function(e){var i=e.getParameter("listItem"),o=i&&i.data("tokenId"),s;s=this.getTokens().filter(function(e){return e.getId()===o})[0];if(s&&s.getEditable()){this.fireTokenUpdate({addedTokens:[],removedTokens:[s],type:t.TokenUpdateType.Removed});s.destroy();this._getTokensList().removeItem(i)}this._getTokensList().destroyItems();this._fillList();this.focus()};I.prototype._handleNMoreAccessibility=function(){var e=y.getStaticId("sap.m","MULTICOMBOBOX_OPEN_NMORE_POPOVER"),t=this.getFocusDomRef(),i=t&&t.getAttribute("aria-labelledby"),o=i?i.split(" "):[],s=o.indexOf(e),n=this.getEnabled(),r=!this.getEditable()&&this.getAggregation("tokenizer").getHiddenTokensCount();if(r&&s===-1){o.push(e);n&&this.getFocusDomRef().setAttribute("aria-keyshortcuts","Enter")}else if(s!==-1&&!r){o.splice(s,1);this.getFocusDomRef().removeAttribute("aria-keyshortcuts")}if(t&&o.length){t.setAttribute("aria-labelledby",o.join(" ").trim())}};I.prototype._getSelectedItemsPicker=function(){if(this._oSelectedItemPicker){return this._oSelectedItemPicker}this._oSelectedItemPicker=new a(this._getDropdownSettings()).setInitialFocus(this);if(!this.isMobileDevice()){this._oSelectedItemPicker.setHorizontalScrolling(false).attachBeforeOpen(this._onBeforeOpenTokensPicker,this).attachAfterClose(function(){this._manageListsVisibility(false);this._bShowListWithTokens=false},this).addContent(this._getTokensList())}return this._oSelectedItemPicker};I.prototype._getReadOnlyPopover=function(){if(!this._oReadOnlyPopover){this._oReadOnlyPopover=new a({showArrow:true,placement:v.Auto,showHeader:false,contentMinWidth:"auto"}).addStyleClass("sapMMultiInputReadOnlyPopover")}return this._oReadOnlyPopover};I.prototype._getDropdownSettings=function(){return{showArrow:false,showHeader:false,placement:v.VerticalPreferredBottom,offsetX:0,offsetY:0,bounce:false}};I.prototype._calculateSpaceForTokenizer=function(){var e=this.getDomRef();if(e){var t,i=this.$().find(".sapMInputDescriptionWrapper"),o=this.$().find(".sapMInputBaseInner"),s=e.offsetWidth||0,n=i.width()||0,r=this._calculateIconsSpace(),a=["min-width","padding-right","padding-left"],l=a.reduce(function(e,t){return e+(parseInt(o.css(t))||0)},0);t=s-(r+l+n);t=t<0?0:t;return t+"px"}else{return null}};I.prototype._syncInputWidth=function(e){var t=this.getDomRef("inner"),i,o;if(!t||e&&!e.getDomRef()){return}i=this._calculateIconsSpace();o=Math.ceil(e.getDomRef().getBoundingClientRect().width);t.style.width="calc(100% - "+Math.floor(i+o)+"px"};I.prototype.isValueHelpOnlyOpener=function(e){return[this._$input[0],this._getValueHelpIcon().getDomRef()].indexOf(e)>-1};I.prototype._shouldTriggerSuggest=function(){var t=e.prototype._shouldTriggerSuggest.apply(this,arguments);return t&&!this._bShowListWithTokens};I.prototype.addValidator=function(e){if(typeof e==="function"){this._aTokenValidators.push(e)}};I.prototype.removeValidator=function(e){var t=this._aTokenValidators.indexOf(e);if(t!==-1){this._aTokenValidators.splice(t,1)}};I.prototype.removeAllValidators=function(){this._aTokenValidators=[]};I.prototype.getValidators=function(){return this._aTokenValidators};I.prototype.addValidateToken=function(e,i){var o=this._validateToken(e,i),s=this._addUniqueToken(o,e.validationCallback);if(s){this.fireTokenUpdate({addedTokens:[o],removedTokens:[],type:t.TokenUpdateType.Added});this.fireTokenChange({addedTokens:[o],removedTokens:[],type:t.TokenChangeType.TokensChanged})}};I.prototype._validateToken=function(e,t){var i=e.token,o=e.validationCallback,s=e.suggestionObject,n=i&&i.getText(),r=n?n:e.text,a;t=t?t:this._aTokenValidators;a=t.length;if(!a){if(!i&&o){o(false)}return i}for(var l=0;l<a;l++){i=t[l]({text:r,suggestedToken:i,suggestionObject:s,asyncCallback:this._getAsyncValidationCallback(t,l,r,s,o)});if(!i){if(o){o(false)}return null}if(i===I.WaitForAsyncValidation){return null}}return i};I.prototype._addUniqueToken=function(e,t){if(!e){return false}var i=!this._tokenExists(e);i&&this.addToken(e);if(t){t(i)}return i};I.prototype._tokenExists=function(e){var t=this.getTokens(),i=t.length,o=e&&e.getKey();if(!o){return false}for(var s=0;s<i;s++){if(t[s].getKey()===o){return true}}return false};I.prototype._convertTextToToken=function(e,t){var i=this.getAggregation("tokenizer"),o=i.getTokens().length,s=this._configureTokenOptions(e,false,t),n=s.text,r=s.item,a=s.token;if(!n){return null}return this._validateToken({text:n,token:a,suggestionObject:r,validationCallback:this._validationCallback.bind(this,o)})};I.prototype._validateCurrentText=function(e){var t=this.getAggregation("tokenizer"),i=t.getTokens().length,o=this._configureTokenOptions(this.getValue(),e),s=o.text,n=o.item,r=o.token;if(!s){return null}if(n){this._bTokenIsAdded=true}if(!this.getMaxTokens()||this.getTokens().length<this.getMaxTokens()){this._bIsValidating=true;this.addValidateToken({text:s,token:r,suggestionObject:n,validationCallback:this._validationCallback.bind(this,i)})}};I.prototype._configureTokenOptions=function(e,t,o){var s,n;if(e&&this.getEditable()){e=e.trim()}if(e&&(t||o||this._getIsSuggestionPopupOpen())){if(this._hasTabularSuggestions()){s=this._oSuggestionTable.getSelectedItem()}else{s=this._getSuggestionItem(e,t)}}if(s&&s.getText&&s.getKey){n=new i({text:s.getText(),key:s.getKey()})}return{text:e,item:s,token:n}};I.prototype._getAsyncValidationCallback=function(e,t,i,o,s){var n=this;return function(r){if(r){r=n.addValidateToken({text:i,token:r,suggestionObject:o,validationCallback:s},e.slice(t+1))}else{s&&s(false)}}};return I});